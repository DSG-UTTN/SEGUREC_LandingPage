# SEGUREC Landing Page - Configuracion Apache BASICA

RewriteEngine On
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^([^.]+)$ $1.php [NC,L]

# Pagina de inicio por defecto

DirectoryIndex index.php index.html

# Proteger archivos de configuracion
<Files "config.php">

    Order Allow,Deny

    Deny from all

</Files>
<Files "functions.php">

    Order Allow,Deny

    Deny from all

</Files>
<Files "composer.*">

    Order Allow,Deny

    Deny from all

</Files>
<Files "package*.json">

    Order Allow,Deny

    Deny from all

</Files>

# ============================================
# COMPRESIÓN GZIP - PERFORMANCE OPTIMIZATION
# ============================================
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE text/javascript
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE application/xhtml+xml
    AddOutputFilterByType DEFLATE application/rss+xml
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/x-javascript
    AddOutputFilterByType DEFLATE application/x-font-ttf
    AddOutputFilterByType DEFLATE application/x-font-otf
    AddOutputFilterByType DEFLATE font/truetype
    AddOutputFilterByType DEFLATE font/opentype
    AddOutputFilterByType DEFLATE image/svg+xml
</IfModule>

# ============================================
# CACHE CONTROL HEADERS - BROWSER CACHING
# ============================================

# Archivos estáticos - Cache largo (1 año)
<FilesMatch "\.(jpg|jpeg|png|gif|ico|css|js|svg|webp|woff|woff2|ttf|eot)$">
    Header set Cache-Control "public, max-age=31536000, immutable"
    Header set Expires "Thu, 19 Dec 2030 23:59:59 GMT"
</FilesMatch>

# HTML - Cache corto (1 hora)
<FilesMatch "\.html?$">
    Header set Cache-Control "public, max-age=3600, must-revalidate"
</FilesMatch>

# PHP - No cachear
<FilesMatch "\.php$">
    Header set Cache-Control "no-cache, no-store, must-revalidate, max-age=0"
    Header set Pragma "no-cache"
    Header set Expires "Thu, 01 Jan 1970 00:00:00 GMT"
</FilesMatch>

# JSON - Cache corto (1 hora)
<FilesMatch "\.json$">
    Header set Cache-Control "public, max-age=3600"
</FilesMatch>

# ============================================
# BROWSER CACHE EXPIRATION - MOD_EXPIRES
# ============================================
<IfModule mod_expires.c>
    ExpiresActive On
    
    # Imágenes - 1 año
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/webp "access plus 1 year"
    ExpiresByType image/svg+xml "access plus 1 year"
    ExpiresByType image/x-icon "access plus 1 year"
    
    # CSS y JavaScript - 1 año
    ExpiresByType text/css "access plus 1 year"
    ExpiresByType application/javascript "access plus 1 year"
    ExpiresByType text/javascript "access plus 1 year"
    
    # Fuentes - 1 año
    ExpiresByType font/truetype "access plus 1 year"
    ExpiresByType font/opentype "access plus 1 year"
    ExpiresByType application/x-font-woff "access plus 1 year"
    ExpiresByType application/x-font-woff2 "access plus 1 year"
    
    # HTML - 1 hora
    ExpiresByType text/html "access plus 1 hours"
    
    # JSON - 1 hora
    ExpiresByType application/json "access plus 1 hours"
    
    # Default - 1 mes
    ExpiresDefault "access plus 1 month"
</IfModule>

# ============================================
# HEADERS DE SEGURIDAD Y PERFORMANCE
# ============================================
<IfModule mod_headers.c>
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    Header always set Permissions-Policy "geolocation=(), microphone=(), camera=()"
</IfModule>

# Desactivar listado de directorios
Options -Indexes

# Bloquear acceso a archivos sensibles
<FilesMatch "\.(htaccess|htpasswd|ini|log|php~|php#|php.bak|php.swp|php.old|md)$">

    Order Allow,Deny

    Deny from all

</FilesMatch>

# Configuracion basica de PHP (si esta disponible)
<IfModule mod_php7.c>

    php_flag display_errors off

    php_value memory_limit 128M

    php_value max_execution_time 30

    php_value post_max_size 32M

    php_value upload_max_filesize 32M

</IfModule>
<IfModule mod_php8.c>

    php_flag display_errors off

    php_value memory_limit 128M

    php_value max_execution_time 30

    php_value post_max_size 32M

    php_value upload_max_filesize 32M

</IfModule>

# ============================================
# OPTIMIZACIONES ADICIONALES DE PERFORMANCE
# ============================================

# Etags - Ayuda a la revalidación de caché
<IfModule mod_headers.c>
    FileETag "INode MTime Size"
</IfModule>

# Deshabilitar ETags en directorios específicos si es necesario
# <Directory "/var/www/html/public/images">
#     FileETag None
# </Directory>

# Conectar con anticipación a recursos externos
<IfModule mod_headers.c>
    Header set Link "</public/css/tailwind.css>; rel=preload; as=style" env=REQUEST_METHOD
    Header set Link "</public/js/main.js>; rel=preload; as=script" env=REQUEST_METHOD
</IfModule>